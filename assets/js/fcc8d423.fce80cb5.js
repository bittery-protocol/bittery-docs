"use strict";(globalThis.webpackChunkbittery_docs=globalThis.webpackChunkbittery_docs||[]).push([[6718],{6868:(e,r,i)=>{i.r(r),i.d(r,{assets:()=>l,contentTitle:()=>c,default:()=>h,frontMatter:()=>o,metadata:()=>n,toc:()=>d});const n=JSON.parse('{"id":"architecture-report","title":"Bittery Protocol Architecture (Field Report)","description":"This page distills the latest architecture report used by the core team to brief integrators. It complements the concise protocol-overview doc with more narrative and operational notes.","source":"@site/docs/architecture-report.md","sourceDirName":".","slug":"/architecture-report","permalink":"/architecture-report","draft":false,"unlisted":false,"editUrl":"https://github.com/bittery-protocol/bittery-docs/edit/main/docs/architecture-report.md","tags":[],"version":"current","frontMatter":{}}');var s=i(6070),t=i(9438);const o={},c="Bittery Protocol Architecture (Field Report)",l={},d=[{value:"Layered Stack at a Glance",id:"layered-stack-at-a-glance",level:2},{value:"Bittery Issuance Inscription (BII)",id:"bittery-issuance-inscription-bii",level:2},{value:"BTRY OP_RETURN Payloads (CBOR)",id:"btry-op_return-payloads-cbor",level:2},{value:"Round Lifecycle (summary)",id:"round-lifecycle-summary",level:2},{value:"Indexer \u2194 ICP Flow (high level)",id:"indexer--icp-flow-high-level",level:2},{value:"Security Posture",id:"security-posture",level:2},{value:"Operational Tips",id:"operational-tips",level:2}];function a(e){const r={code:"code",h1:"h1",h2:"h2",header:"header",li:"li",ol:"ol",p:"p",pre:"pre",strong:"strong",ul:"ul",...(0,t.R)(),...e.components};return(0,s.jsxs)(s.Fragment,{children:[(0,s.jsx)(r.header,{children:(0,s.jsx)(r.h1,{id:"bittery-protocol-architecture-field-report",children:"Bittery Protocol Architecture (Field Report)"})}),"\n",(0,s.jsxs)(r.p,{children:["This page distills the latest architecture report used by the core team to brief integrators. It complements the concise ",(0,s.jsx)(r.code,{children:"protocol-overview"})," doc with more narrative and operational notes."]}),"\n",(0,s.jsx)(r.h2,{id:"layered-stack-at-a-glance",children:"Layered Stack at a Glance"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Bitcoin L1"}),": UTXO settlement for wagers, OP_RETURN metadata, payouts. Prize pool UTXO is TSS\u2011controlled."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Ordinals L2"}),": Hosts Bittery Issuance Inscription (BII) JSON and optional ticket NFTs."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Off-chain indexer"}),": Scans Bitcoin, decodes BTRY OP_RETURN payloads, enforces BII windows, builds candidate bet sets and Merkle roots."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"ICP canister (final judge)"}),": Validates bets, executes VRF, selects winners, triggers TSS Bitcoin payouts."]}),"\n"]}),"\n",(0,s.jsx)(r.pre,{children:(0,s.jsx)(r.code,{children:"L3: ICP (state machine, VRF, TSS payouts)\n   ^  HTTP outcalls\n   v\nOff-chain indexer (scan + Merkle roots)\n   ^\n   v\nL2: Ordinals metadata (BII, tickets)\n   ^\n   v\nL1: Bitcoin (wagers, payouts, OP_RETURN)\n"})}),"\n",(0,s.jsx)(r.h2,{id:"bittery-issuance-inscription-bii",children:"Bittery Issuance Inscription (BII)"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Publishes round rules on Ordinals before betting opens."}),"\n",(0,s.jsxs)(r.li,{children:["Key fields: ",(0,s.jsx)(r.code,{children:"round_id"}),", ",(0,s.jsx)(r.code,{children:"prize_pool_address"}),", ",(0,s.jsx)(r.code,{children:"tss_pubkey"}),", ",(0,s.jsx)(r.code,{children:"min_bet_sats/max_bet_sats"}),", ",(0,s.jsx)(r.code,{children:"min_tickets/max_tickets"}),", ",(0,s.jsx)(r.code,{children:"start_block/end_block"}),", ",(0,s.jsx)(r.code,{children:"payout_policy"}),", ",(0,s.jsx)(r.code,{children:"rollover"}),", ",(0,s.jsx)(r.code,{children:"metadata_hash"}),"."]}),"\n",(0,s.jsx)(r.li,{children:"Validation boundary: ICP re-checks protocol/version, address, block window, payout policy, and metadata hash against the BII payload observed on Ordinals."}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"btry-op_return-payloads-cbor",children:"BTRY OP_RETURN Payloads (CBOR)"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:["Actions: ",(0,s.jsx)(r.strong,{children:"Init"}),", ",(0,s.jsx)(r.strong,{children:"Bet"}),", ",(0,s.jsx)(r.strong,{children:"Term"}),"."]}),"\n",(0,s.jsxs)(r.li,{children:["Common keys: ",(0,s.jsx)(r.code,{children:"v"})," (version), ",(0,s.jsx)(r.code,{children:"g"})," (game id), ",(0,s.jsx)(r.code,{children:"r"})," (round id), ",(0,s.jsx)(r.code,{children:"op"})," (action)."]}),"\n",(0,s.jsxs)(r.li,{children:["Bet payload adds ",(0,s.jsx)(r.code,{children:"amt"})," and optional encoded ",(0,s.jsx)(r.code,{children:"nums"})," per game rules."]}),"\n",(0,s.jsx)(r.li,{children:"Term payload signals shutdown; payout handling follows the policy committed in Init (carry/refund/treasury), not overrideable by Term."}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"round-lifecycle-summary",children:"Round Lifecycle (summary)"}),"\n",(0,s.jsxs)(r.p,{children:[(0,s.jsx)(r.code,{children:"OPEN \u2192 CLOSED \u2192 DRAWING \u2192 FINISHED"})," (see ",(0,s.jsx)(r.code,{children:"round-lifecycle"})," for details). ICP waits ",(0,s.jsx)(r.code,{children:"k_confirm"})," after ",(0,s.jsx)(r.code,{children:"end_block"}),", ingests indexer roots, runs VRF, and signs payouts via TSS."]}),"\n",(0,s.jsx)(r.h2,{id:"indexer--icp-flow-high-level",children:"Indexer \u2194 ICP Flow (high level)"}),"\n",(0,s.jsxs)(r.ol,{children:["\n",(0,s.jsx)(r.li,{children:"Indexers scan each Bitcoin block, derive per-round Merkle roots over candidate bets."}),"\n",(0,s.jsx)(r.li,{children:"Roots and counts are posted to an indexer-canister; the main canister gathers \u22652/3 matching roots across indexers."}),"\n",(0,s.jsxs)(r.li,{children:["After ",(0,s.jsx)(r.code,{children:"k_confirm"})," on the source blocks, accepted roots become ",(0,s.jsx)(r.code,{children:"VerifiedBets"})," and the round advances to DRAWING \u2192 payout."]}),"\n",(0,s.jsx)(r.li,{children:"Reorg detection rolls back affected heights and re-requests roots."}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"security-posture",children:"Security Posture"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Bitcoin immutability"})," anchors wagers, payouts, and OP_RETURN."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"Ordinals"})," fix round metadata and optional ticket NFTs."]}),"\n",(0,s.jsxs)(r.li,{children:[(0,s.jsx)(r.strong,{children:"ICP + TSS"})," ensure deterministic draw logic and exclusive control of prize funds."]}),"\n",(0,s.jsx)(r.li,{children:"Indexers are untrusted; consensus on Merkle roots plus multi-source rechecks mitigates corruption."}),"\n"]}),"\n",(0,s.jsx)(r.h2,{id:"operational-tips",children:"Operational Tips"}),"\n",(0,s.jsxs)(r.ul,{children:["\n",(0,s.jsx)(r.li,{children:"Monitor indexer scan progress, ingest success rate, VRF latency, and TSS signing time."}),"\n",(0,s.jsxs)(r.li,{children:["Use \u22656 confirmations on ",(0,s.jsx)(r.code,{children:"end_block"})," to reduce reorg exposure."]}),"\n",(0,s.jsxs)(r.li,{children:["Keep audit logs of ",(0,s.jsx)(r.code,{children:"(block_height, block_hash)"})," for every verified bet; re-validate on reorg."]}),"\n",(0,s.jsx)(r.li,{children:"For deployments, practice full round simulations (dfx + mock indexer) before mainnet."}),"\n"]})]})}function h(e={}){const{wrapper:r}={...(0,t.R)(),...e.components};return r?(0,s.jsx)(r,{...e,children:(0,s.jsx)(a,{...e})}):a(e)}}}]);